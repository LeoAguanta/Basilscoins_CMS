(function(n,t){t.module("ui.bootstrap.contextMenu",[]).service("CustomService",function(){"use strict";return{initialize:function(n){console.log("got here",n)}}}).constant("ContextMenuEvents",{ContextMenuAllClosed:"context-menu-all-closed",ContextMenuClosed:"context-menu-closed",ContextMenuOpening:"context-menu-opening",ContextMenuOpened:"context-menu-opened"}).directive("contextMenu",["$rootScope","ContextMenuEvents","$parse","$q","CustomService","$sce","$document","$window","$compile",function(i,r,u,f,e,o,s,h,c){function rt(i){var s=i.$scope,r=i.item,y=i.event,p=i.modelValue,w=i.$promises,k=i.nestedMenu,d=i.$li,v=String(i.orientation).toLowerCase()==="left",h=null,u,e,o,l,a;return r.html?h=t.isFunction(r.html)?r.html(s):r.compile?c(r.html)(s):r.html:(u=n("<a>"),e={},v?(e.textAlign="right",e.paddingLeft="8px"):(e.textAlign="left",e.paddingRight="8px"),u.css(e),u.addClass("dropdown-item"),u.attr({tabindex:"-1",href:"#"}),o=r.text||r[0],l=b,typeof o=="string"?l=o:typeof o=="function"&&(l=o.call(s,s,y,p)),a=f.when(l),w.push(a),a.then(function(t){var r,i,f;k&&(i={fontFamily:"monospace",fontWeight:"bold"},v?(r="&lt;",i.float="left"):(r="&gt;",i.float="right"),f=n('<strong style="font-family:monospace;font-weight:bold;float:right;">'+r+"<\/strong>"),f.css(i),u.css("cursor","default"),u.append(f));u.append(t)}),h=u),d.append(h),h}function ut(n){var u=et(n),e=b,i=t.extend({},n),r=n.item,f=r.enabled===undefined?r[2]:r.enabled;i.nestedMenu=u;i.enabled=y(f,n);i.text=rt(i);ft(i)}function ft(i){var o=i.item,s=i.$ul,e=i.$li,r=i.$scope,h=i.modelValue,c=i.level,u=i.event,l=i.text,v=i.nestedMenu,b=i.enabled,y=String(i.orientation).toLowerCase(),k=i.customClass,w;if(b){w=function(n){p(c+1);var i={pageX:y==="left"?u.pageX-s[0].offsetWidth+1:u.pageX+s[0].offsetWidth-1,pageY:s[0].offsetTop+e[0].offsetTop-3,view:u.view||window,target:u.target,event:n};f.when(v).then(function(n){t.isFunction(n)&&(n=n.call(r,r,u,h,l,e));var f={$scope:r,event:i,options:n,modelValue:h,level:c+1,orientation:y,customClass:k};d(f)})};e.on("click",function(i){i.which==1&&(i.preventDefault(),r.$apply(function(){var f=function(){n(u.currentTarget).removeClass("context");a()},s=t.isFunction(o.click)?o.click:t.isFunction(o[1])?o[1]:null,i;s?(i=s.call(r,r,u,h,l,e),(i===undefined||i)&&f()):f()}))});e.on("mouseover",function(n){r.$apply(function(){v?w(n):p(c+1)})})}else it(e)}function et(n){var i=n.item;return i.children?t.isFunction(i.children)?i.children():t.isFunction(i.children.then)||t.isArray(i.children)?i.children:null:t.isArray(i[1])||i[1]&&t.isFunction(i[1].then)?i[1]:t.isArray(i[2])||i[2]&&t.isFunction(i[2].then)?i[2]:t.isArray(i[3])||i[3]&&t.isFunction(i[3].then)?i[3]:null}function d(u){var a=u.$scope,p=u.event,c=u.options,b=u.modelValue,d=u.level,g=u.customClass,f=st(u),h,o;u.$ul=f;v.push(f);h=[];u.$promises=h;t.forEach(c,function(i){var s,o,r;i===null?w(f):(s=y(i.displayed,u),s&&(o=n("<li>"),r=t.extend({},u),r.item=i,r.$li=o,typeof i[0]=="object"?e.initialize(o,i):ut(r),y(i.hasTopDivider,r,!1)&&w(f),f.append(o),y(i.hasBottomDivider,r,!1)&&w(f)))});f.children().length===0&&(o=t.element("<li>"),it(o),o.html("<a>"+k+"<\/a>"),f.append(o));s.find("body").append(f);ot(u);i.$broadcast(r.ContextMenuOpened,{context:l,contextMenu:f,params:u})}function ot(n){var r=n.$ul,e=n.$promises,u=n.level,i=n.event,o=String(n.orientation).toLowerCase()==="left";f.all(e).then(function(){var f=i.pageY,a=t.element(r[0]).prop("offsetHeight"),v=h.pageYOffset+i.view.innerHeight,y,c;f>a&&v-f<a+20?(f=i.pageY-a,u&&u>0&&(f+=i.event.currentTarget.offsetHeight)):v<=a?(t.element(r[0]).css({height:v-5,"overflow-y":"scroll"}),f=0):v-f<a&&(y=5,f<y&&(y=f),f=v-a-y);var n=i.pageX,e=t.element(r[0]).prop("offsetWidth"),l=i.view.innerWidth+window.pageXOffset,s=5;o?l-n>e&&n<e+s?n=s:n<e?(c=5,l-n<c+s&&(c=l-n+s),n=e+c+s):n=n-e:n>e&&l-n-s<e?n=l-e-s:l-n<e&&(c=5,n<c+s&&(c=n+s),n=l-e-c-s);r.css({display:"block",position:"absolute",left:n+"px",top:f+"px"})})}function st(t){var r=t.customClass,i=n("<ul>");return i.addClass("dropdown-menu"),i.attr({role:"menu"}),i.css({display:"block",position:"absolute",left:t.event.pageX+"px",top:t.event.pageY+"px","z-index":1e4}),r&&i.addClass(r),i}function ht(){return"ontouchstart"in window||navigator.maxTouchPoints}function p(n){while(v.length&&(!n||v.length>n)){var t=v.pop();i.$broadcast(r.ContextMenuClosed,{context:l,contextMenu:t});t.remove()}n||i.$broadcast(r.ContextMenuAllClosed,{context:l})}function g(n){a(n)}function nt(t){for(var i=n(t.target),r=!0;i.length;)if(i.hasClass("dropdown-menu")){r=!1;break}else i=i.parent();r&&a(t)}function a(){s.find("body").off("mousedown touchstart",nt);s.off("scroll",g);n(l).removeClass("context");p();i.$broadcast("")}function tt(n){return n===!1||n===!0}function y(n,i,r){var o=i.item,u=i.$scope,f=i.event,e=i.modelValue;return r=tt(r)?r:!0,tt(n)?n:t.isFunction(n)?n.call(u,u,f,e):r}function w(n){var i=t.element("<li>");i.addClass("divider");n.append(i)}function it(n){n.on("click",function(n){n.preventDefault()});n.addClass("disabled")}var v=[],l=null,b='"New Item',k="empty";return function(u,e,o){var h=["contextmenu"];k=u.$eval(o.contextMenuEmptyText)||"empty";o.contextMenuOn&&typeof o.contextMenuOn=="string"&&(h=o.contextMenuOn.split(","));t.forEach(h,function(h){e.on(h.trim(),function(h){if(a(),o.allowEventPropagation||(h.stopPropagation(),h.preventDefault()),ht()&&e.attr("draggable")==="true")return!1;s.find("body").on("mousedown touchstart",nt);s.on("scroll",g);l=h.currentTarget;n(l).addClass("context");u.$apply(function(){var e=u.$eval(o.contextMenu),s=o.contextMenuClass,n=u.$eval(o.model),c=o.contextMenuOrientation;f.when(e).then(function(f){t.isFunction(f)&&(f=f.call(u,u,h,n));var e={$scope:u,event:h,options:f,modelValue:n,level:0,customClass:s,orientation:c};i.$broadcast(r.ContextMenuOpening,{context:l});d(e)})});u.$on("$destroy",function(){a()})})});o.closeMenuOn&&u.$on(o.closeMenuOn,function(){a()})}}])})(window.angular.element,window.angular);